!function(e,o,t){"use strict";function a(e){var o=s.val().split("?",1);s.val(o[0]+"?page=agm_settings#top#"+e)}function n(e){var o=m.styles.filter(function(o){return parseInt(o.id)===parseInt(e)});return o.length?o[0].style:[]}function l(){p=new google.maps.LatLng(parseFloat(m.map.lat),parseFloat(m.map.lng)),d={center:p,streetViewControl:!0,zoom:parseInt(m.map.zoom),mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_LEFT},styles:n(m.map.style),fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},gestureHandling:"auto"},c=new google.maps.Map(v,d);var a=t("#agm-lat"),l=t("#agm-lng"),r=t("#agm-zoom"),i=t("#agm-zoom-val"),s=new google.maps.Marker({draggable:!0,position:p,optimized:!1,map:c,title:"Current Location",icon:m.marker.file||m.marker.color||""});google.maps.event.addListener(c,"rightclick",function(e){a.val(e.latLng.lat()),l.val(e.latLng.lng()),s.setTitle("Selected Location"),s.setPosition(e.latLng)}),google.maps.event.addListener(s,"dragend",function(e){a.val(e.latLng.lat()),l.val(e.latLng.lng())}),google.maps.event.addListener(c,"zoom_changed",function(){r.val(c.getZoom()),i.html(c.getZoom())}),google.maps.event.addListener(c,"center_changed",function(){var e=c.getCenter();a.val(e.lat()),l.val(e.lng())}),google.maps.event.addListener(c,"idle",function(){google.maps.event.trigger(c,"resize")});var g;google.maps.event.addDomListener(e,"resize",function(){g&&clearTimeout(g),g=e.setTimeout(function(){c.setCenter(p)},300)}),r.on("input.agm click.agm",function(){i.html(this.value),c.setZoom(parseInt(r.val()))});var u=o.querySelector("#agm-search"),f=new google.maps.places.Autocomplete(u);c.controls[google.maps.ControlPosition.TOP_LEFT].push(u),google.maps.event.addListener(f,"place_changed",function(){var e=f.getPlace();e.geometry&&(c.panTo(e.geometry.location),s.setPosition(e.geometry.location),c.setZoom(15),s.setTitle(e.formatted_address))})}var r=e.location.hash.replace("#top#",""),i=t("h2#wpt-tabs"),s=t("form#agm-form").find('input:hidden[name="_wp_http_referer"]'),g=t("section.tab-content");""!==r&&0!==t("#"+r).length||(r=g.attr("id")),t("#"+r).addClass("active"),t("#"+r+"-tab").addClass("nav-tab-active"),a(r),i.find("a.nav-tab").on("click.agm",function(e){e.stopPropagation(),i.find("a.nav-tab").removeClass("nav-tab-active"),g.removeClass("active");var o=t(this).attr("id").replace("-tab","");t("#"+o).addClass("active"),t(this).addClass("nav-tab-active"),a(o)});var c,p,m=e._agmOpt,d={},v=o.querySelector("#agm-canvas");"object"==typeof google&&google.maps?google.maps.event.addDomListener(e,"load",l):v.innerHTML='<h4 class="map-not-loaded" style="text-align: center;color: #ba060b">Failed to load Google Map.<br>Refresh this page and try again.<br>Check your internet connection as well.</h4>',t("#wpt-loc-tab").one("click.agm",function(){try{google.maps.event.trigger(c,"resize"),c.setCenter(p)}catch(e){console.error("Google map not loaded yet")}}),t("#agm-map-style").on("change.agm",function(e){e.preventDefault();try{c.setOptions({styles:n(t(this).val())})}catch(e){console.error("Google map not loaded yet")}}),t("#agm-search").on("keydown",function(e){return 13===e.keyCode||13===e.which?(e.preventDefault(),e.stopPropagation(),!1):void 0});try{t("#agm-border-color").wpColorPicker()}catch(u){console.error("WP Color Picker not loaded")}var f;t("#agm-marker-file").on("click.agm",function(e){e.preventDefault();var o=t(this);return f?void f.open():(f=wp.media({title:"Choose Marker",button:{text:"Choose Image"},library:{type:"image"},multiple:!1}),f.on("select",function(){o.prev("input").val(f.state().get("selection").first().toJSON().url)}),void f.open())})}(window,document,jQuery);
